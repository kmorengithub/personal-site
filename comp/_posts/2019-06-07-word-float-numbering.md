---
title: Нумерация рисунков и подсчет их количества в документе Word
categories: word office
excerpt: >-
  Поля для автоматической нумерации и оформление ссылки с общим
  количеством рисунков, таблиц, формул и т. д.
layout: post
---

Обновить все поля в документе: `Ctrl-A F9`.
Показать значение поля `Shift-F9`
Вставить новое поле `Ctrl-F9`

Вставлять поле нужно через комбинацию клавиш, а не простым вводом
фигурных скобок.

# Начальная настройка

Будем использовать следующие имена переменных:
- ch — номер текущего раздела для основной части отчета
- fig — нумерация рисунков в пределах главы
- tbl — нумерация таблиц в пределах главы
- eq — нумерация формул в пределах главы

При этом счетчик общего количества рисунков будет именоваться как
`c<var>`, а ярлык для общего количества объектов, заданный в конце
документа, будет `tot<var>`.

В первую очередь, нужно создать новую последовательность для глав и
присвоить ей начальные номера.  Чтобы последовательность работала
автоматически, я добавляю ее в строчку после каждого заголовка раздела

    { seq ch \h \n }

Еще в начале каждой главы стоит принудительный сброс номера рисунка

    { seq fig \r 0 \h }

Этот код создает или увеличивает последовательность (ключ `\n`),
причем само поле будет скрыто (ключ `\h`) во время печати.  Таким
образом, в каждом заголовке будет увеличение номера
последовательности.

Для вставки подписи рисунка в формате ГЛАВА.РИСУНОК следующий код

    { seq ch \c }.{ seq fig \n }
	
Здесь ключ `\c` означает повтор номера главы *без увеличения на
единицу*, а ключ `\s 2` сбрасывает счетчик после каждого заголовка
второго уровня (первым уровнем являются структурные элементы, вторым —
разделы в основной части отчета).

## Получение количества рисунков в документе

Чтобы получить количество рисунков в документе, нужно каждому рисунку
добавить код, считающий его порядковый номер в cfig (count fig).  Это
поле скрыто размещается в каждой подрисуночной надписи.

    { seq cfig \n \h }

В конце документа находится поле, содержащее общее количество
рисунков, и повторяющее последний номер.  Его назначение --- дать
ярлык для обращения из начала отчета.

    { set totfig { seq cfig \c } }
	
Теперь в начале документа можно сделать ссылку на количество рисунков

    { ref totfig }
	
# Использование макросов

Макросы вставляют не только поля, но и шаблоны текстов, а так же
форматируют с помощью стилей.

## Макрос вставки подписи под рисунок


	Sub InsFig()
	'
	' InsFig Macros
	' Insert new figure
	'
		Selection.Style = ActiveDocument.Styles("Название рисунка")
		Selection.TypeText Text:="Рисунок "
		Selection.Fields.Add Range:=Selection.Range, Type:=wdFieldEmpty, _
			PreserveFormatting:=False, Text:="seq ch \c"
		Selection.TypeText Text:="."
		Selection.Fields.Add Range:=Selection.Range, Type:=wdFieldEmpty, _
			PreserveFormatting:=False, Text:="seq fig \n"
		Selection.Fields.Add Range:=Selection.Range, Type:=wdFieldEmpty, _
			PreserveFormatting:=False, Text:="seq cfig \n \h"
		Selection.TypeText Text:=" — "

	End Sub
